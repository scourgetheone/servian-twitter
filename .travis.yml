language: generic

jobs:
    include:
      - stage: "Compile and tests"
      - language: python
        python: 3.7
        install:
          - pip install -r requirements.txt
          - python setup.py develop
        script:
          - cd servian_twitter
          - pytest

      - language: node_js
        node_js: 13
        cache: yarn
        script:
          - cd ui
          - yarn install
          - yarn test
          - cd ../
          - bash build_ui.sh # Build the UI module

      - stage: deploy
        name: "Deploy to Google App Engine"
        before_deploy:
        - openssl aes-256-cbc -K $encrypted_645f850629f0_key -iv $encrypted_645f850629f0_iv
          -in hazel-tome-269200-2c4a7c4121d6.json.enc -out hazel-tome-269200-2c4a7c4121d6.json
          -d

        deploy:
            provider: gae
            keyfile: "hazel-tome-269200-2c4a7c4121d6.json"
            project: "hazel-tome-269200"
